
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Create and build the Docker Image Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="step3.html" />
    
    
    <link rel="prev" href="step1.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">docker101 lab</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../lab0/lab0.html">
            
                <a href="../lab0/lab0.html">
            
                    
                    Lab 0: Install Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../lab1/lab1.html">
            
                <a href="../lab1/lab1.html">
            
                    
                    Lab 1: Run your first container
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../lab1/step1.html">
            
                <a href="../lab1/step1.html">
            
                    
                    Run your first container
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../lab1/step2.html">
            
                <a href="../lab1/step2.html">
            
                    
                    Run Multiple Containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../lab1/step3.html">
            
                <a href="../lab1/step3.html">
            
                    
                    Clean Up
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="lab2.html">
            
                <a href="lab2.html">
            
                    
                    Lab 2: Adding Value with Custom Docker Images
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="step1.html">
            
                <a href="step1.html">
            
                    
                    Login to Docker Hub and Create a python app
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.2" data-path="step2.html">
            
                <a href="step2.html">
            
                    
                    Create and build the Docker Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="step3.html">
            
                <a href="step3.html">
            
                    
                    Run the Docker image and Push to a central registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="step4.html">
            
                <a href="step4.html">
            
                    
                    Deploying a Change
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../lab3/lab3.html">
            
                <a href="../lab3/lab3.html">
            
                    
                    Lab 3: Introduction to Orchestration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../lab3/step1.html">
            
                <a href="../lab3/step1.html">
            
                    
                    Create your first swarm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../lab3/step2.html">
            
                <a href="../lab3/step2.html">
            
                    
                    Deploy your first service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../lab3/step3.html">
            
                <a href="../lab3/step3.html">
            
                    
                    Scale your service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../lab3/step4.html">
            
                <a href="../lab3/step4.html">
            
                    
                    Rolling Updates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../lab3/step5.html">
            
                <a href="../lab3/step5.html">
            
                    
                    Reconciliation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../troubleshooting/troubleshooting.html">
            
                <a href="../troubleshooting/troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other Resources</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://developer.ibm.com/gettingstarted/containers/">
            
                    
                    Get started with containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <a target="_blank" href="https://docs.docker.com/">
            
                    
                    Docker Documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <a target="_blank" href="https://www.youtube.com/watch?v=JSLpG_spOBM">
            
                    
                    What is Containers and Dockers?
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">IBM Developer</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../team.html">
            
                <a href="../team.html">
            
                    
                    IBM Developer ASEAN Team
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Create and build the Docker Image</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="lab-2--adding-value-with-custom-docker-images">Lab 2- Adding Value with Custom Docker Images</h1>
<h2 id="step-2-create-and-build-the-docker-image">Step 2: Create and build the Docker Image</h2>
<p>If you don&apos;t have python install locally, don&apos;t worry! Because you don&apos;t need it. One of the advantages of using Docker containers is that you can build python into your containers, without having python installed on your host. </p>
<ol>
<li><p>Create a <code>Dockerfile</code> but running the following command. Using any code editor (e.g. VScode, Atom, Sublime, etc), copy-paste the entire code block. Or download <code>Dockerfile</code> from <a href="https://github.com/IraAngeles-IBM/docker101/tree/master/files" target="_blank">GitHub repository</a>. The files must be saved in the directory created above.</p>
<pre><code class="lang-DockerFile"> <span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.6</span>.<span class="hljs-number">1</span>-alpine
 <span class="hljs-keyword">RUN</span> <span class="bash">pip install flask
</span> <span class="hljs-keyword">CMD</span> <span class="bash">[<span class="hljs-string">&quot;python&quot;</span>,<span class="hljs-string">&quot;app.py&quot;</span>]
</span> <span class="hljs-keyword">COPY</span> <span class="bash">app.py /app.py
</span></code></pre>
<p> A Dockerfile lists the instructions needed to build a docker image. Let&apos;s go through the above file line by line.</p>
<p> <strong>FROM python:3.6.1-alpine</strong></p>
<p> This is the starting point for your Dockerfile. Every Dockerfile must start with a <code>FROM</code> line that is the starting image to build your layers on top of. In this case, we are selecting the <code>python:3.6.1-alpine</code> base layer since it already has the version of python and pip that we need to run our application. The <code>alpine</code> version means that it uses the alpine distribution, which is significantly smaller than an alternative flavor of linux. A smaller image means it will download (deploy) much faster, and it also has advantages for security because it has a smaller attack surface.</p>
<p> Here we are using the &quot;3.6.1-alpine&quot; tag for the python image. Take a look at the available tags for the official python image on the <a href="https://hub.docker.com/_/python/" target="_blank">Docker Hub</a>. It is best practice to use a specific tag when inheriting a parent image so that changes to the parent dependency are controlled. If no tag is specified, the &quot;latest&quot; tag takes into effect, which is acts as a dynamic pointer that points to the latest version of an image. </p>
<p> For security reasons, it is very important to understand the layers that you build your docker image on top of. For that reason, it is highly recommended to only use &quot;official&quot; images found in the <a href="https://hub.docker.com/" target="_blank">docker hub</a>, or non-community images found in the docker-store. These images are <a href="https://docs.docker.com/docker-hub/official_repos/" target="_blank">vetted</a> to meet certain security requirements, and also have very good documentation for users to follow. You can find more information about this <a href="https://store.docker.com/images/python" target="_blank">python base image</a>, as well as all other images that you can use, on the <a href="https://store.docker.com/" target="_blank">docker store</a>.</p>
<p> For a more complex application you may find the need to use a<code>FROM</code> image that is higher up the chain. For example, the parent <a href="https://github.com/docker-library/python/blob/88ba87d31a3033d4dbefecf44ce25aa1b69ab3e5/3.6/alpine/Dockerfile" target="_blank">Dockerfile</a> for our python app  starts with <code>FROM alpine</code>, then specifies a series of <code>CMD</code> and <code>RUN</code> commands for the image. If you needed more fine-grained control, you could start with <code>FROM alpine</code> (or a different distribution) and run those steps yourself. To start off though, I recommend using an official image that closely matches your needs.</p>
<p> <strong>RUN pip install flask</strong></p>
<p> The <code>RUN</code> command executes commands needed to set up your image for your application, such as installing packages, editing files, or changing file permissions. In this case we are installing flask. The <code>RUN</code> commands are executed at build time, and are added to the layers of your image. </p>
<p> <strong>CMD [&quot;python&quot;,&quot;app.py&quot;]</strong></p>
<p> <code>CMD</code> is the command that is executed when you start a container. Here we are using <code>CMD</code> to run our python app. </p>
<p> There can be only one <code>CMD</code> per Dockerfile. If you specify more thane one <code>CMD</code>, then the last <code>CMD</code> will take effect. The parent python:3.6.1-alpine also specifies a <code>CMD</code> (<code>CMD python2</code>). You can find the Dockerfile for the official python:alpine image (here) [<a href="https://github.com/docker-library/python/blob/88ba87d31a3033d4dbefecf44ce25aa1b69ab3e5/3.6/alpine/Dockerfile" target="_blank">https://github.com/docker-library/python/blob/88ba87d31a3033d4dbefecf44ce25aa1b69ab3e5/3.6/alpine/Dockerfile</a>]. </p>
<p> You can use the official python image directly to run python scripts without installing python on your host. But today, we are creating a custom image to include our source, so that we can build an image with our application and ship it around to other environments.</p>
<p> <strong>COPY app.py /app.py</strong></p>
<p> This copies the app.py in the local directory (where you will run <code>docker image build</code>) into a new layer of the image. This instruction is the last line in the Dockerfile. Layers that change frequently, such as copying source code into the image, should be placed near the bottom of the file to take full advantage of the Docker layer cache. This allows us to avoid rebuilding layers that could otherwise be cached. For instance, if there was a change in the <code>FROM</code> instruction, it would invalidate the cache for all subsequent layers of this image. We will demonstrate a this little later in this lab.</p>
<p> It seems counter-intuitive to put this after the <code>CMD [&quot;python&quot;,&quot;app.py&quot;]</code> line. Remember, the <code>CMD</code> line is executed only when the container is started, so we won&apos;t get a <code>file not found</code> error here. </p>
<p> And there you have it: a very simple Dockerfile. A full list of commands you can put into a Dockerfile can be found <a href="https://docs.docker.com/engine/reference/builder/" target="_blank">here</a>. Now that we defined our Dockerfile, let&apos;s use it to build our custom docker image.</p>
</li>
<li><p>Build the docker image. </p>
<p> Pass in <code>-t</code> to name your image <code>$DOCKER_USER/python-hello-world</code>, with the tag <code>v1</code> to indicate this is the first version of the image</p>
<pre><code class="lang-sh"> docker image build -t <span class="hljs-variable">$DOCKER_USER</span>/python-hello-world:v1 .
 $ Sending build context to Docker daemon  3.072kB
 Step 1/4 : FROM python:3.6.1-alpine
 3.6.1-alpine: Pulling from library/python
 acb474fa8956: Pull complete 
 967ab02d1ea4: Pull complete 
 640064d26350: Pull complete 
 db0225fcac8f: Pull complete 
 5432cc692c60: Pull complete 
 Digest: sha256:768360b3fad01adffcf5ad9eccb4aa3ccc83bb0ed341bbdc45951e89335082ce
 Status: Downloaded newer image <span class="hljs-keyword">for</span> python:3.6.1-alpine
  ---&gt; c86415c03c37
 Step 2/4 : RUN pip install flask
 ---&gt; Running <span class="hljs-keyword">in</span> cac3222673a3
 Collecting flask
  Downloading Flask-0.12.2-py2.py3-none-any.whl (83kB)
 Collecting itsdangerous&gt;=0.21 (from flask)
   Downloading itsdangerous-0.24.tar.gz (46kB)
 Collecting click&gt;=2.0 (from flask)
   Downloading click-6.7-py2.py3-none-any.whl (71kB)
 Collecting Werkzeug&gt;=0.7 (from flask)
   Downloading Werkzeug-0.12.2-py2.py3-none-any.whl (312kB)
 Collecting Jinja2&gt;=2.4 (from flask)
   Downloading Jinja2-2.9.6-py2.py3-none-any.whl (340kB)
 Collecting MarkupSafe&gt;=0.23 (from Jinja2&gt;=2.4-&gt;flask)
   Downloading MarkupSafe-1.0.tar.gz
 Building wheels <span class="hljs-keyword">for</span> collected packages: itsdangerous, MarkupSafe
  Running setup.py bdist_wheel <span class="hljs-keyword">for</span> itsdangerous: started
  Running setup.py bdist_wheel <span class="hljs-keyword">for</span> itsdangerous: finished with status <span class="hljs-string">&apos;done&apos;</span>
  Stored <span class="hljs-keyword">in</span> directory: /root/.cache/pip/wheels/<span class="hljs-built_in">fc</span>/a8/66/24d655233c757e178d45dea2de22a04c6d92766abfb741129a
  Running setup.py bdist_wheel <span class="hljs-keyword">for</span> MarkupSafe: started
  Running setup.py bdist_wheel <span class="hljs-keyword">for</span> MarkupSafe: finished with status <span class="hljs-string">&apos;done&apos;</span>
  Stored <span class="hljs-keyword">in</span> directory: /root/.cache/pip/wheels/88/a7/30/e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57
 Successfully built itsdangerous MarkupSafe
 Installing collected packages: itsdangerous, click, Werkzeug, MarkupSafe, Jinja2, flask
 Successfully installed Jinja2-2.9.6 MarkupSafe-1.0 Werkzeug-0.12.2 click-6.7 flask-0.12.2 itsdangerous-0.24
 ---&gt; ce41f2517c16
 Removing intermediate container cac3222673a3
 Step 3/4 : CMD python app.py
 ---&gt; Running <span class="hljs-keyword">in</span> 2197e5263eff
 ---&gt; 0ab91286958b
 Removing intermediate container 2197e5263eff
 Step 4/4 : COPY app.py /app.py
 ---&gt; f1b2781b3111
 Removing intermediate container b92b506ee093
 Successfully built f1b2781b3111
 Successfully tagged python-hello-world:latest
</code></pre>
<p> Verify that your image shows up in your image list via <code>docker image ls | grep $DOCKER_USEr</code>.</p>
<pre><code class="lang-sh"> docker image ls | grep <span class="hljs-variable">$DOCKER_USER</span>
 $ isaias/python-hello-world                                                                                                                                       v1                  7feaf028e337        9 seconds ago       98.7MB
</code></pre>
</li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="step1.html" class="navigation navigation-prev " aria-label="Previous page: Login to Docker Hub and Create a python app">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="step3.html" class="navigation navigation-next " aria-label="Next page: Run the Docker image and Push to a central registry">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Create and build the Docker Image","level":"1.4.2","depth":2,"next":{"title":"Run the Docker image and Push to a central registry","level":"1.4.3","depth":2,"path":"lab2/step3.md","ref":"lab2/step3.md","articles":[]},"previous":{"title":"Login to Docker Hub and Create a python app","level":"1.4.1","depth":2,"path":"lab2/step1.md","ref":"lab2/step1.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["custom-favicon"],"pluginsConfig":{"favicon":"/images/favicon.ico","custom-favicon":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"lab2/step2.md","mtime":"2020-08-03T06:36:53.457Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-03T07:07:48.250Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

